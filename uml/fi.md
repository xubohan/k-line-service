# 股票K线数据服务

## 依赖的外部服务
- 股票名称服务
  - 名称存在时
    - 返回股票名称和数据
  - 名称不存在时
    - 返回约定值

## 组件模块
### Kafka订阅模块
- 消费Kafka队列 (topic_id='timeline') 的股票数据  
- 将数据解析并存入缓存和数据库  
- 高并发时批量消费并限流，避免系统过载  
- 数据消费失败时  
  - 重试  
  - 熔断  
  - 日志记录  
  - 死信队列 (DLQ)  

### 数据存储模块
- 本地缓存 (L1，可选)  
  - 存储热点股票数据，减少 Redis 访问频率  
  - 适用于快速访问的热点数据，降低网络开销  
- Redis缓存 (L2)  
  - 缓存分钟级股票数据，支持高并发查询  
  - 配置过期时间，避免缓存过期导致的性能问题  
  - 缓存失效时  
    - 延迟加载策略  
    - 异步查询数据库并平稳回填缓存  
- 数据库存储  
  - 持久化股票数据，保证数据不丢失  
  - 作为权威数据源，保证最终一致性  
  - 配置高可用性，避免单点故障  

### HTTP接口模块
- 名称存在时  
  - 返回股票名称和对应数据  
  - 优先从 Redis 缓存获取，未命中时查询数据库并回填缓存  
- 名称不存在时  
  - 返回约定值  
- 限流  
  - Sentinel 在 HTTP 接口入口进行流量控制和熔断  
  - 查询数据库时进行限流，防止数据库被频繁访问和击穿
